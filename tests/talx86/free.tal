; TAL IMPLEMENTATION fact2
; This file was generated by TALC
	INCLUDE	TAL.INC
	_begin_TAL


	TAL_IMPORT	pop_runtime.tali
	TAL_IMPORT	free_i.tali

	TAL_EXPORT	tal_prog.tali
	TAL_EXPORT	free_e.tali

	TYPE	<bogus_option$1 :T4 = ^T[0]>

	CODE

__main$:
LABELTYPE <All[s1:Ts s2:Ts cg:Tt].code {TLA: ^*[cg^rw],EBP: sptr (?E s2 cg),ESP: sptr (?Sv s1 s2 cg)@(?E s2 cg)}>
	PUSH	DWORD PTR [_tal_args]
	PUSH	subsume(<B4>,2)
	MOV	EAX,[ESP+4]
	UNPACK	?sz$6,EAX,EAX
	MOV	EAX,subsume(<B4>,[EAX])
	POP	ECX
	CMP	EAX,ECX
	JE	iffalse$4
iftrue$3:
	MOV	EBX,subsume(<B4>,0)
	MOV	EAX,[ESP]
	UNPACK	?sz$7,EAX,EAX
	UNPACK	i$8,EBX,EBX
	CMP	EBX,[EAX]
	JAE	_array_bounds_error
	PUSH	DWORD PTR [EAX+4*EBX+4]
	CALL	tapp(_Core?print_string,<ESP 1 3 s1,EBP 1,cg>)
	MOV	[ESP],string$9
	CALL	tapp(_Core?print_string,<ESP 1 3 s1,EBP 1,cg>)
	ADD	ESP,4
	CALL	tapp(_Core?print_newline,<ESP 0 2 s1,EBP 1,cg>)
	JMP	ifend$5
iffalse$4:
	MOV	EBX,subsume(<B4>,1)
	MOV	EAX,[ESP]
	UNPACK	?sz$10,EAX,EAX
	UNPACK	i$11,EBX,EBX
	CMP	EBX,[EAX]
	JAE	_array_bounds_error
	PUSH	DWORD PTR [EAX+4*EBX+4]
	CALL	tapp(_Core?int_of_string,<ESP 1 3 s1,EBP 1,cg>)
	MOV	[ESP],EAX
	PUSH	DWORD PTR [ESP]
	CALL	tapp(_fact,<ESP 1 4 s1,EBP 1,cg>)
	MOV	[ESP],EAX
	CALL	tapp(_Core?print_int,<ESP 1 4 s1,EBP 1,cg>)
	ADD	ESP,4
	CALL	tapp(_Core?print_newline,<ESP 0 3 s1,EBP 1,cg>)
	ADD	ESP,4
ifend$5:
	ADD	ESP,4
	RETN
_fact:
LABELTYPE <All[s1:Ts s2:Ts cg:Tt].code {TLA: ^*[cg^rw],EBP: sptr (?E s2 cg),ESP: sptr (?S B4 B4::s1 s2 cg)@(?E s2 cg)}>
; This does allocation and freeing.
	MALLOC	mptr$12,8
	MOV	EBX,EAX
	MOV	EAX,[ESP+4]
	MOV	[EBX],EAX
	MOV	[EBX+4],EAX
	PUSH	EBX
	MOV	ESI, 34
	MOV	EDI, 1
	CALL    tapp(_GC_free,<*[B4^rw,B4^rw],mptr$12,&[],Nm(mptr$12),B4,B4,sptr (?E s2 cg),(?S B4 B4::s1 s2 cg)@(?E s2 cg),cg>)
	POP	EDX
	MOV	EAX,ESI
	RETN
_tal_main:
LABELTYPE <code {TLA: ^*[te^rw,B4^rw,B4^rw,B4^rw],ESP: sptr se}>
	PUSH	_pop_exn_handler
	MOV	EBP,ESP
	CALL	tapp(__main$,<se,se,te>)
	POP	EBX
	PUSH	0
	JMP	tapp(_tal_exit,<se>)

	DATA

string$9:
COERCE	pack(<14>,array(4,0,<B1^rw>,?),<?str>)
	DD	14
	TAL_STRUCT
	DB	58,32,117,115,97,103,101,58,32,60,110,117,109,62

	_end_TAL
	END
